#!/usr/bin/env sh



# exit if error happens
set -e



# go to docker
script_dir="$( cd "$(dirname "$0")" ; pwd -P )"
cd "$script_dir"
cd "../docker"



# load environment
. ../.env




# compose
docker-compose \
  --env-file ../.env \
  --project-name mojeklima \
  up \
  --detach \
  --build



# post-script
if [ "$APP_MODE" = "production" ]; then
  echo "Will not try to create a database schema, because it is only allowed in development application mode"
  exit 0
fi

echo "Waiting 5 seconds for the containers to be initialized..."
sleep 5 # wait for containers to be initialized

docker exec mojeklima-api php ./cli/doctrine orm:schema-tool:create
